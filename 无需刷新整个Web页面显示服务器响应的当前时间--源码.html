<html>
<head>
  <title>无需刷新整个Web页面显示服务器响应的当前时间--源码</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/10.0.14393 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1710"/>
<h1>无需刷新整个Web页面显示服务器响应的当前时间--源码</h1>

<div>
<span><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><b><span style="color: rgb(255, 70, 53);">ajaxtime.jsp</span></b></div><div>&lt;%@ page language=&quot;java&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</div><div>&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;&gt;</div><div>&lt;html&gt;</div><div>  &lt;head&gt;</div><div>    &lt;title&gt;无需刷新整个Web页面显示服务器响应的当前时间&lt;/title&gt;</div><div>  &lt;/head&gt;</div><div>  &lt;body&gt;</div><div><br/></div><div>      当前时间：&lt;span id=&quot;time&quot;&gt;&lt;/span&gt;&lt;br/&gt;</div><div>      &lt;input id=&quot;buttonID&quot; type=&quot;button&quot; value=&quot;获取当前时间&quot;/&gt;&lt;p/&gt;</div><div><br/></div><div><br/></div><div>      &lt;script type=&quot;text/javascript&quot;&gt;</div><div>            //创建AJAX异步对象</div><div>            function createAJAX(){</div><div>                  var ajax = null;</div><div>                  try{</div><div>                        //如果IE5=IE12的话</div><div>                        ajax = new ActiveXObject(&quot;microsoft.xmlhttp&quot;);</div><div>                  }catch(e1){</div><div>                        try{</div><div>                              //如果是非IE的话</div><div>                              ajax = new XMLHttpRequest();</div><div>                        }catch(e2){</div><div>                              alert(&quot;你的浏览器中不支持异步对象，请换浏览器&quot;);</div><div>                        }</div><div>                  }</div><div>                  return ajax;</div><div>            }</div><div>      &lt;/script&gt;</div><div><br/></div><div>      &lt;script type=&quot;text/javascript&quot;&gt;</div><div>            document.getElementById(&quot;buttonID&quot;).onclick = function(){</div><div>                  //NO1)创建AJAX异步对象</div><div>                  var ajax = createAJAX();</div><div>                  //NO2)准备发送请求</div><div>                  var method = &quot;GET&quot;;</div><div>                  var url = &quot;${pageContext.request.contextPath}/AjaxTimeServlet?time=&quot; + new Date().getTime();</div><div>                  ajax.open(method,url);</div><div>                  //NO3)真正发送请求体的数据到服务器，如果请求体中无数据的话，就用null表示</div><div>                  ajax.send(null);</div><div><br/></div><div>                  //-------------------------------------------------------------等待</div><div><br/></div><div>                  //NO4)AJAX异步对象不断监听服务器响应的状态0-1-2-3-【4】</div><div>                  //一定要状态变化后，才可触发function(){}函数</div><div>                  //如果状态永远是4-4-4-4-4，是不会触发function(){}函数的</div><div>                  ajax.onreadystatechange = function(){</div><div>                        //如果状态码为4的话</div><div>                        if(ajax.readyState == 4){</div><div>                              //如果响应码为200的话</div><div>                              if(ajax.status == 200){</div><div>                                    //NO5)从AJAX异步对象中获取服务器响应的HTML数据</div><div>                                    var nowStr = ajax.responseText;</div><div><br/></div><div>                                    //NO6)将结果按照DOM规则，动态添加到web页面指定的标签中</div><div>                                    var spanElement = document.getElementById(&quot;time&quot;);</div><div>                                    spanElement.innerHTML = nowStr;</div><div>                              }</div><div>                        }</div><div>                  }</div><div><br/></div><div>            }</div><div>      &lt;/script&gt;</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>      静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本静态文本&lt;br/&gt;</div><div>  &lt;/body&gt;</div><div>&lt;/html&gt;</div></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><b><span style="color: rgb(255, 70, 53);">ajaxtimeservlet.jav</span></b>a</div><div><br/></div><div>package cn.itcast.javaee.js.time;</div><div><br/></div><div>import java.io.IOException;</div><div>import java.io.PrintWriter;</div><div>import java.text.SimpleDateFormat;</div><div>import java.util.Date;</div><div>import javax.servlet.ServletException;</div><div>import javax.servlet.http.HttpServlet;</div><div>import javax.servlet.http.HttpServletRequest;</div><div>import javax.servlet.http.HttpServletResponse;</div><div><br/></div><div>/**</div><div> * 无需刷新整个Web页面显示服务器响应的当前时间</div><div> * @author Radish</div><div> */</div><div>public class AjaxTimeServlet extends HttpServlet {</div><div>    public void doGet(HttpServletRequest request, HttpServletResponse response)throws ServletException, IOException {</div><div>        SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</div><div>        String nowStr = sdf.format(new Date());</div><div><br/></div><div>        //以流的方式将结果响应到AJAX异步对象中</div><div>        response.setContentType(&quot;text/html;charset=UTF-8&quot;);</div><div>        PrintWriter pw = response.getWriter();</div><div>        pw.write(nowStr);</div><div>        pw.flush();</div><div>        pw.close();</div><div>    }</div><div>}</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><b><span style="color: rgb(255, 0, 0);">web.xml</span></b></span></span></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">&lt;?</span></font><font color="#839496" face="Courier New" size="2"><span style="font-size:10pt"><u>xml</u></span></font> <font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">&lt;web-</span></font><font color="#839496" face="Courier New" size="2"><span style="font-size:10pt"><u>app</u></span></font> <font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">version=&quot;2.5&quot;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">      </span></font><font color="#839496" face="Courier New" size="2"><span style="font-size:10pt"><u>xmlns</u></span></font><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">=&quot;http://java.sun.com/xml/ns/javaee&quot;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">      xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">      xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">      http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt"> </span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt"> </span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt"> </span></font> <font color="#839496" face="Courier New" size="2"><span style="font-size:10pt"><u>&lt;servlet&gt;</u></span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">    &lt;servlet-name&gt;TimeServlet&lt;/servlet-name&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">    &lt;servlet-class&gt;cn.itcast.javaee.js.time.TimeServlet&lt;/servlet-class&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt"> </span></font> <font color="#839496" face="Courier New" size="2"><span style="font-size:10pt"><u>&lt;/servlet&gt;</u></span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt"> </span></font> <font color="#839496" face="Courier New" size="2"><span style="font-size:10pt"><u>&lt;servlet&gt;</u></span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">    &lt;servlet-name&gt;AjaxTimeServlet&lt;/servlet-name&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">    &lt;servlet-class&gt;cn.itcast.javaee.js.time.AjaxTimeServlet&lt;/servlet-class&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt"> </span></font> <font color="#839496" face="Courier New" size="2"><span style="font-size:10pt"><u>&lt;/servlet&gt;</u></span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt"> </span></font> <font color="#839496" face="Courier New" size="2"><span style="font-size:10pt"><u>&lt;servlet&gt;</u></span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">    &lt;servlet-name&gt;UserServlet&lt;/servlet-name&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">    &lt;servlet-class&gt;cn.itcast.javaee.js.user.UserServlet&lt;/servlet-class&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt"> </span></font> <font color="#839496" face="Courier New" size="2"><span style="font-size:10pt"><u>&lt;/servlet&gt;</u></span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt"> </span></font> <font color="#839496" face="Courier New" size="2"><span style="font-size:10pt"><u>&lt;servlet&gt;</u></span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">    &lt;servlet-name&gt;ProvinceCityServlet&lt;/servlet-name&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">    &lt;servlet-class&gt;cn.itcast.javaee.js.provincecity.ProvinceCityServlet&lt;/servlet-class&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt"> </span></font> <font color="#839496" face="Courier New" size="2"><span style="font-size:10pt"><u>&lt;/servlet&gt;</u></span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">  &lt;servlet-mapping&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">    &lt;servlet-name&gt;TimeServlet&lt;/servlet-name&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">    &lt;url-pattern&gt;/TimeServlet&lt;/url-pattern&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">  &lt;/servlet-mapping&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">  &lt;servlet-mapping&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">    &lt;servlet-name&gt;AjaxTimeServlet&lt;/servlet-name&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">    &lt;url-pattern&gt;/AjaxTimeServlet&lt;/url-pattern&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">  &lt;/servlet-mapping&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">  &lt;servlet-mapping&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">    &lt;servlet-name&gt;UserServlet&lt;/servlet-name&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">    &lt;url-pattern&gt;/UserServlet&lt;/url-pattern&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">  &lt;/servlet-mapping&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">  &lt;servlet-mapping&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">    &lt;servlet-name&gt;ProvinceCityServlet&lt;/servlet-name&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">    &lt;url-pattern&gt;/ProvinceCityServlet&lt;/url-pattern&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">  &lt;/servlet-mapping&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt"> </span></font></div><div align="left" style="min-height: 10pt;"><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt"> </span></font></div><div align="left" style="min-height: 10pt;"><div><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">&lt;/web-</span></font><font color="#839496" face="Courier New" size="2"><span style="font-size:10pt"><u>app</u></span></font><font color="#010101" face="Courier New" size="2"><span style="font-size:10pt">&gt;</span></font></div></div></div><div><br/></div></span>
</div></body></html> 