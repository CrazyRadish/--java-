<html>
<head>
  <title>Cookie案例</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/10.0.14393 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2281"/>
<h1>Cookie案例</h1>

<div>
<span><div><br/></div><div align="justify" style="font-weight: bold; font-size: 20px;"><font color="#010101" face="宋体"><span style="font-size:12pt"><b>案例- 显示用户上次访问的时间</b></span></font></div><div><img src="Cookie案例_files/用户上次访问时间.png" type="image/png"/></div><div>源码：</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="color: rgb(255, 0, 0);">public class HistServlet extends HttpServlet {</span></div><div><span style="color: rgb(255, 0, 0);"><br/></span></div><div><span style="color: rgb(255, 0, 0);">      public void doGet(HttpServletRequest request, HttpServletResponse response)</span></div><div><span style="color: rgb(255, 0, 0);">                  throws ServletException, IOException {</span></div><div><span style="color: rgb(255, 0, 0);">            response.setContentType(&quot;text/html;charset=utf-8&quot;);</span></div><div><span style="color: rgb(255, 0, 0);"><br/></span></div><div><span style="color: rgb(255, 0, 0);">           <span style="font-size: 21px;"> //获取当前时间</span></span></div><div><span style="color: rgb(255, 0, 0);">            SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd hh:mm:ss&quot;);</span></div><div><span style="color: rgb(255, 0, 0);">            String curTime = format.format(new Date());</span></div><div><span style="color: rgb(255, 0, 0);"><br/></span></div><div><span style="color: rgb(255, 0, 0);"><br/></span></div><div><span style="color: rgb(255, 0, 0);">            <span style="font-size: 21px;">//取得cookie</span></span></div><div><span style="color: rgb(255, 0, 0);">            Cookie[] cookies = request.getCookies();</span></div><div><span style="color: rgb(255, 0, 0);">            String lastTime = null;</span></div><div><span style="color: rgb(255, 0, 0);">            if(cookies!=null){</span></div><div><span style="color: rgb(255, 0, 0);">                  for (Cookie cookie : cookies) {</span></div><div><span style="color: rgb(255, 0, 0);">                        if(cookie.getName().equals(&quot;lastTime&quot;)){</span></div><div><span style="color: rgb(255, 0, 0);">                              //有lastTime的cookie，已经是第n次访问</span></div><div><span style="color: rgb(255, 0, 0);">                              lastTime = cookie.getValue();//上次访问的时间</span></div><div><span style="color: rgb(255, 0, 0);">                              //第n次访问</span></div><div><span style="color: rgb(255, 0, 0);">                              //1.把上次显示时间显示到浏览器</span></div><div><span style="color: rgb(255, 0, 0);">                              response.getWriter().write(&quot;欢迎回来，你上次访问的时间为：&quot;+lastTime+&quot;,当前时间为：&quot;+curTime);</span></div><div><span style="color: rgb(255, 0, 0);">                              //2.更新cookie</span></div><div><span style="color: rgb(255, 0, 0);">                              cookie.setValue(curTime);</span></div><div><span style="color: rgb(255, 0, 0);">                              cookie.setMaxAge(1*30*24*60*60);</span></div><div><span style="color: rgb(255, 0, 0);">                              //3.把更新后的cookie发送到浏览器</span></div><div><span style="color: rgb(255, 0, 0);">                              response.addCookie(cookie);</span></div><div><span style="color: rgb(255, 0, 0);">                              break;</span></div><div><span style="color: rgb(255, 0, 0);">                        }</span></div><div><span style="color: rgb(255, 0, 0);">                  }</span></div><div><span style="color: rgb(255, 0, 0);">            }</span></div><div><span style="color: rgb(255, 0, 0);"><br/></span></div><div><span style="color: rgb(255, 0, 0);">            /**</span></div><div><span style="color: rgb(255, 0, 0);">             * 第一次访问（没有cookie 或 有cookie，但没有名为lastTime的cookie）</span></div><div><span style="color: rgb(255, 0, 0);">             */</span></div><div><span style="color: rgb(255, 0, 0);">            if(cookies==null || lastTime==null){</span></div><div><span style="color: rgb(255, 0, 0);">                  //1.显示当前时间到浏览器</span></div><div><span style="color: rgb(255, 0, 0);">                  response.getWriter().write(&quot;你是首次访问本网站，当前时间为：&quot;+curTime);</span></div><div><span style="color: rgb(255, 0, 0);">                  //2.创建Cookie对象</span></div><div><span style="color: rgb(255, 0, 0);">                  Cookie cookie = new Cookie(&quot;lastTime&quot;,curTime);</span></div><div><span style="color: rgb(255, 0, 0);">                  cookie.setMaxAge(1*30*24*60*60);//保存一个月</span></div><div><span style="color: rgb(255, 0, 0);">                  //3.把cookie发送到浏览器保存</span></div><div><span style="color: rgb(255, 0, 0);">                  response.addCookie(cookie);</span></div><div><span style="color: rgb(255, 0, 0);">            }</span></div><div><span style="color: rgb(255, 0, 0);">      }</span></div></div><div><br/></div><div><br/></div><div align="justify" style="font-weight: bold; font-size: 20px;"><font color="#010101" face="宋体"><span style="font-size:12pt"><b>案例-查看用户浏览器过的商品</b></span></font></div><div align="justify" style="font-weight: bold; font-size: 20px;"><span style="font-size: 12pt;"><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></span></div><div align="justify" style="font-weight: bold;"><font color="#010101" face="宋体" size="4"><span>源码：</span></font></div><div align="justify" style="font-weight: bold;"><font color="#010101" face="宋体" size="4"><span style="line-height: 23px;">entity类</span></font></div><div align="justify" style="font-weight: bold;"><span style="font-size: 16px;"><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><a href="Cookie案例_files/Product.java"><img src="Cookie案例_files/711aebd12bc7764ade1fe4140644cef6.png" alt="Product.java"></a></span></span></span></div><div align="justify" style="font-weight: bold;"><font color="#010101" face="宋体" size="4"><span>dao类</span></font></div><div align="justify" style="font-weight: bold;"><span style="font-size: 16px;"><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><a href="Cookie案例_files/ProductDao.java"><img src="Cookie案例_files/15dba7df7d60f09acc0ce1c1c9f9aefc.png" alt="ProductDao.java"></a></span></span></span></div><div align="justify" style="font-weight: bold;"><font color="#010101" face="宋体" size="4"><span>Servlet类，用于设置cookie，以及得到cookie</span></font></div><div align="justify" style="font-weight: bold;"><span style="font-size: 16px;"><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><a href="Cookie案例_files/DetailServlet.java"><img src="Cookie案例_files/692ec059e73f4732f110fddf774f7199.png" alt="DetailServlet.java"></a><a href="Cookie案例_files/ListServlet.java"><img src="Cookie案例_files/59038b8b8f0b0fb93f6745d8eb75805c.png" alt="ListServlet.java"></a><br/></span></span></span></div></span>
</div></body></html> 