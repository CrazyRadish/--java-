<html>
<head>
  <title>Sevlet的生命周期（2）（Key）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/10.0.14393 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2543"/>
<h1>Sevlet的生命周期（2）（Key）</h1>

<div>
<span><div><h1 align="justify"><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>5 Servlet</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:14pt"><b>的自动加载</b></span></font></h1><div align="justify" style="min-height: 13pt;"><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">                     </span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">默认情况下，第一次访问servlet的时候创建servlet对象。如果servlet的构造方法或init方法中执行了比较多的逻辑代码，那么导致用户第一次访问sevrlet的时候比较慢。</span></font></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">                     </span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">改变servlet创建对象的时机：</span></font> <font color="#FF0000" face="宋体" size="2"><span style="font-size:10pt">提前到加载web应用的时候！！！</span></font></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">                     </span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">在servlet的配置信息中，加上一个&lt;load-on-startup&gt;即可！！</span></font></div><div align="justify" style="min-height: 12pt;"><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">              </span></font></div><div style="margin-left: -2mm;"><table cellpadding="0" cellspacing="0" style="border-collapse: collapse; border-width: 1px; border-color: #000000;width:586px;" width="583"><tr><td align="left" style="border: solid #000000 1px;width:100%;" valign="top" width="582"><font color="#008080" face="Courier New" size="2"><span style="font-size:10pt">&lt;</span></font><font color="#3F7F7F" face="Courier New" size="2"><span style="font-size:10pt">servlet</span></font><font color="#008080" face="Courier New" size="2"><span style="font-size:10pt">&gt;</span></font><div align="left" style="min-height: 10pt;"><font face="Courier New" size="2"><span style="font-size:10pt">   </span></font> <font color="#008080" face="Courier New" size="2"><span style="font-size:10pt">&lt;</span></font><font color="#3F7F7F" face="Courier New" size="2"><span style="font-size:10pt">servlet-name</span></font><font color="#008080" face="Courier New" size="2"><span style="font-size:10pt">&gt;</span></font><font face="Courier New" size="2"><span style="font-size:10pt">LifeDemo</span></font><font color="#008080" face="Courier New" size="2"><span style="font-size:10pt">&lt;/</span></font><font color="#3F7F7F" face="Courier New" size="2"><span style="font-size:10pt">servlet-name</span></font><font color="#008080" face="Courier New" size="2"><span style="font-size:10pt">&gt;</span></font></div><div align="left" style="min-height: 10pt;"><font face="Courier New" size="2"><span style="font-size:10pt">   </span></font> <font color="#008080" face="Courier New" size="2"><span style="font-size:10pt">&lt;</span></font><font color="#3F7F7F" face="Courier New" size="2"><span style="font-size:10pt">servlet-class</span></font><font color="#008080" face="Courier New" size="2"><span style="font-size:10pt">&gt;</span></font><font face="Courier New" size="2"><span style="font-size:10pt">gz.itcast.c_life.LifeDemo</span></font><font color="#008080" face="Courier New" size="2"><span style="font-size:10pt">&lt;/</span></font><font color="#3F7F7F" face="Courier New" size="2"><span style="font-size:10pt">servlet-class</span></font><font color="#008080" face="Courier New" size="2"><span style="font-size:10pt">&gt;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Courier New" size="2"><span style="font-size:10pt">   </span></font> <font color="#3F5FBF" face="Courier New" size="2"><span style="font-size:10pt">&lt;!--</span></font> <font color="#3F5FBF" face="宋体" size="2"><span style="font-size:10pt">让</span></font><font color="#3F5FBF" face="Courier New" size="2"><span style="font-size:10pt"><u>servlet</u></span></font><font color="#3F5FBF" face="宋体" size="2"><span style="font-size:10pt">对象自动加载 --&gt;</span></font></div><div align="left" style="min-height: 14pt;"><font face="Courier New" size="2"><span style="font-size:10pt">   </span></font> <font color="#FF0000" face="Courier New" size="2"><span style="font-size:10pt">&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span></font><font color="#FF0000" face="宋体" size="2"><span style="font-size:10pt">  注意： 整数值越大，创建优先级越低！！</span></font></div><div align="justify" style="min-height: 10pt;"><font face="Courier New" size="2"><span style="font-size:10pt"> </span></font> <font color="#008080" face="Courier New" size="2"><span style="font-size:10pt">&lt;/</span></font><font color="#3F7F7F" face="Courier New" size="2"><span style="font-size:10pt">servlet</span></font><font color="#008080" face="Courier New" size="2"><span style="font-size:10pt">&gt;</span></font></div></td></tr></table></div></div><div><br/></div><div align="justify" style="font-weight: bold; font-size: 26px;"><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>7</b></span></font> <font color="#010101" face="宋体" size="4"><span style="font-size:14pt"><b>有参的init方法和无参的init方法</b></span></font></div><div align="justify" style="font-weight: bold; font-size: 26px;"><span style="font-size: 14pt;"><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></span></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>import javax.servlet.ServletConfig;</div><div>import javax.servlet.ServletException;</div><div>import javax.servlet.http.HttpServlet;</div><div><br/></div><div>/**</div><div> * 有参数的init和无参的init方法</div><div> * @author Radish</div><div> *</div><div> */</div><div>public class InitDemo extends HttpServlet {</div><div><br/></div><div>      /**</div><div>       * 有参数的init方法</div><div>       * 该方法是servlet的生命周期方法，一定会被tomcat服务器调用</div><div>       */</div><div>      /**</div><div>       * 注意：如果要编写初始代码，不需要覆盖有参数的init方法</div><div>       */</div><div>      /*@Override</div><div>      public void init(ServletConfig config) throws ServletException {</div><div>            System.out.println(&quot;有参数的init方法&quot;);</div><div>      }*/</div><div><br/></div><div>      /**</div><div>       * 无参数的init方法</div><div>       * 该方法是servlet的编写初始化代码的方法。是Sun公司设计出来专门给开发者进行覆盖，然后在里面编写servlet的初始逻辑代码的方法。</div><div>       */</div><div>      @Override</div><div>      public void init() throws ServletException {</div><div>            System.out.println(&quot;无参数的init方法&quot;);</div><div>      }</div><div><br/></div><div><br/></div><div>}</div></div><div align="justify" style="font-weight: bold; font-size: 26px;"><span style="font-size: 14pt;"><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><br/></span></span></span></div><div><br/></div><div align="justify" style="font-weight: bold; font-size: 26px;"><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>8 Servlet</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:14pt"><b>的多线程并发问题</b></span></font></div><div align="justify" style="font-weight: bold; font-size: 26px;"><span style="font-size: 14pt;"><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);"><img src="Sevlet的生命周期（2）（Key）_files/servlet多线程并发.png" type="image/png"/><br/></span></span></span></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">              </span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">注意： servlet对象在tomcat服务器是</span></font><i><span style="font-size: 21px;"><font color="#FF0000" face="宋体">单实例多线程</font></span></i><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">的。</span></font></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">              </span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">因为servlet是多线程的，所以当多个servlet的线程同时访问了servlet的共享数据，如成员变量，可能会引发线程安全问题。</span></font></div><div align="justify" style="min-height: 13pt;"><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">              </span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">解决办法：</span></font></div><div align="justify" style="min-height: 14pt;"><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">                            1</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">）把使用到共享数据的代码块进行同步（使用</span></font><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">synchronized</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">关键字进行同步）</span></font></div><div align="justify" style="min-height: 14pt;"><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">                            2</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">）建议在servlet类中尽量不要使用成员变量。如果确实要使用成员，必须同步。而且尽量缩小同步代码块的范围。（哪里使用到了成员变量，就同步哪里！！），以避免因为同步而导致并发效率降低。</span></font></div><div align="justify" style="min-height: 14pt;"><div><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">                    </span></font></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>public class TheradDemo extends HttpServlet {</div><div><br/></div><div>  int count = 1;</div><div><br/></div><div>  public void doGet(HttpServletRequest request, HttpServletResponse response)</div><div>  throws ServletException, IOException {</div><div>  response.setContentType(&quot;text/html;charset=utf-8&quot;);</div><div><br/></div><div>  synchronized (TheradDemo.class) {//锁对象必须唯一。建议使用类对象</div><div>  response.getWriter().write(&quot;你现在是当前网站的第&quot;+count+&quot;个访客&quot;); //线程1执行完 ， 线程2执行</div><div><br/></div><div>  //线程1还没有执行count++</div><div>  /*try {</div><div>  Thread.sleep(5000);</div><div>  } catch (InterruptedException e) {</div><div>  e.printStackTrace();</div><div>  }*/</div><div>  count++;</div><div>  }</div><div>  }</div></div><div><span style="font-family: 'Times New Roman';"><span style="color: rgb(1, 1, 1);"><br/></span></span></div></div></span>
</div></body></html> 