<html>
<head>
  <title>Mysql存储过程</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/10.0.14393 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2292"/>
<h1>Mysql存储过程</h1>

<div>
<span><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><span style="color: rgb(255, 0, 0);"><span style="font-size: 21px;">-- **************三、存储过程*******************-</span></span></div><div>-- 声明结束符</div><div>-- <span style="font-size: 16px;">创建存储过程</span></div><div>DELIMITER $</div><div>CREATE PROCEDURE pro_test()</div><div>BEGIN</div><div>    -- 可以写多个sql语句;</div><div>    SELECT * FROM employee;</div><div>END $</div><div><br/></div><div>-- <span style="font-size: 16px;">执行存储过程</span></div><div>CALL pro_test();</div><div><br/></div><div>-- 3.1 带有输入参数的存储过程</div><div>-- 需求：传入一个员工的id，查询员工信息</div><div>DELIMITER $</div><div>CREATE PROCEDURE pro_findById(IN eid INT)  -- IN: 输入参数</div><div>BEGIN</div><div>    SELECT * FROM employee WHERE id=eid;</div><div>END $</div><div><br/></div><div>-- 调用</div><div>CALL pro_findById(4);</div><div><br/></div><div>-- 3.2 带有输出参数的存储过程</div><div>DELIMITER $</div><div>CREATE PROCEDURE pro_testOut(OUT str VARCHAR(20))  -- OUT：输出参数</div><div>BEGIN</div><div>        -- 给参数赋值</div><div>    SET str='helljava';</div><div>END $</div><div><br/></div><div>-- 删除存储过程</div><div>DROP PROCEDURE pro_testOut;</div><div>-- 调用</div><div>-- 如何接受返回参数的值？？</div><div>-- ***mysql的变量******</div><div><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><i>--  全局变量（内置变量）：mysql数据库内置的变量 （所有连接都起作用）</i></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><i>        -- 查看所有全局变量： show variables</i></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><i>        -- 查看某个全局变量： select @@变量名</i></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><i>        -- 修改全局变量： set 变量名=新值</i></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><i>        -- character_set_client: mysql服务器的接收数据的编码</i></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><i>        -- character_set_results：mysql服务器输出数据的编码</i></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><i><br/></i></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><i>--  会话变量： 只存在于当前客户端与数据库服务器端的一次连接当中。如果连接断开，那么会话变量全部丢失！</i></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><i>        -- 定义会话变量: set @变量=值</i></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><i>        -- 查看会话变量： select @变量</i></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><i><br/></i></span></span></div><div><span style="color: rgb(255, 0, 0);"><span style="font-size: 16px;"><i>-- 局部变量： 在存储过程中使用的变量就叫局部变量。只要存储过程执行完毕，局部变量就丢失！！</i></span></span></div><div><br/></div><div>-- 1)定义一个会话变量name, 2)使用name会话变量接收存储过程的返回值</div><div>CALL pro_testOut(@NAME);</div><div>-- 查看变量值</div><div>SELECT @NAME;</div><div><br/></div><div>-- 3.3 带有输入输出参数的存储过程</div><div>DELIMITER $</div><div>CREATE PROCEDURE pro_testInOut(INOUT n INT)  -- INOUT： 输入输出参数</div><div>BEGIN</div><div>   -- 查看变量</div><div>   SELECT n;</div><div>   SET n =500;</div><div>END $</div><div><br/></div><div>-- 调用</div><div>SET @n=10;</div><div><br/></div><div>CALL pro_testInOut(@n);</div><div><br/></div><div>SELECT @n;</div><div><br/></div><div>-- 3.4 带有条件判断的存储过程</div><div>-- 需求：输入一个整数，如果1，则返回“星期一”,如果2，返回“星期二”,如果3，返回“星期三”。其他数字，返回“错误输入”;</div><div>DELIMITER $</div><div>CREATE PROCEDURE pro_testIf(IN num INT,OUT str VARCHAR(20))</div><div>BEGIN</div><div>    IF num=1 THEN</div><div>        SET str='monday';</div><div>    ELSEIF num=2 THEN</div><div>        SET str='sunday';</div><div>    ELSEIF num=3 THEN</div><div>        SET str='wendesday';</div><div>    ELSE</div><div>        SET str='input error';</div><div>    END IF;</div><div>END $</div><div><br/></div><div>CALL pro_testIf(4,@str);</div><div><br/></div><div>SELECT @str;</div><div><br/></div><div>-- 3.5 带有循环功能的存储过程</div><div>-- 需求： 输入一个整数，求和。例如，输入100，统计1-100的和</div><div>DELIMITER $</div><div>CREATE PROCEDURE pro_testWhile(IN num INT,OUT result INT)</div><div>BEGIN</div><div>    -- 定义一个局部变量</div><div>    DECLARE i INT DEFAULT 1;</div><div>    DECLARE vsum INT DEFAULT 0;</div><div>    WHILE i&lt;=num DO</div><div>          SET vsum = vsum+i;</div><div>          SET i=i+1;</div><div>    END WHILE;</div><div>    SET result=vsum;</div><div>END $</div><div><br/></div><div>DROP PROCEDURE pro_testWhile;</div><div><br/></div><div><br/></div><div>CALL pro_testWhile(100,@result);</div><div><br/></div><div>SELECT @result;</div><div><br/></div><div>USE day16;</div><div><br/></div><div>-- 3.6 使用查询的结果赋值给变量（INTO）</div><div>DELIMITER $</div><div>CREATE PROCEDURE pro_findById2(IN eid INT,OUT vname VARCHAR(20) )</div><div>BEGIN</div><div>    SELECT empName INTO vname FROM employee WHERE id=eid;</div><div>END $</div><div><br/></div><div>CALL pro_findById2(1,@NAME);</div><div><br/></div><div>SELECT @NAME;</div><div><br/></div><div><br/></div><div>USE day15;</div><div><br/></div><div>SELECT * FROM student2;</div><div><br/></div><div>-- 练习： 编写一个存储过程</div><div>    如果学生的英语平均分小于等于70分，则输出'一般'</div><div>    如果学生的英语平均分大于70分，且小于等于90分，则输出‘良好’</div><div>    如果学生的英语平均分大于90分，则输出‘优秀’</div><div><br/></div><div>DELIMITER $</div><div>CREATE PROCEDURE pro_testAvg(OUT str VARCHAR(20))</div><div>BEGIN</div><div>      -- 定义局部变量，接收平均分</div><div>      DECLARE savg DOUBLE;</div><div>      -- 计算英语平方分</div><div>      SELECT AVG(english) INTO savg FROM student2;</div><div>      IF savg&lt;=70 THEN</div><div>           SET str='一般';</div><div>      ELSEIF savg&gt;70 AND savg&lt;=90 THEN</div><div>           SET str='良好';</div><div>      ELSE</div><div>       SET str='优秀';</div><div>      END IF;</div><div>END $</div><div><br/></div><div>CALL pro_testAvg(@str);</div><div><br/></div><div>SELECT @str;</div><div><br/></div></div><div><br/></div></span>
</div></body></html> 